(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[14],{125:function(e,t,r){"use strict";r.r(t);var a=r(4),n=r.n(a),s=r(0),o=r(7),c=r(13),d=r(14),i=r(16),u=r(15),p=r(1),l=r.n(p),m=r(8),h=r(87),f=r(90),b=r(82),O=r(20),g=r(80),v=r(78),y=r(18),j=r.n(y),_=r(106),k=r.n(_),w=function(e){Object(i.a)(r,e);var t=Object(u.a)(r);function r(){var e;Object(c.a)(this,r);for(var a=arguments.length,s=new Array(a),d=0;d<a;d++)s[d]=arguments[d];return(e=t.call.apply(t,[this].concat(s))).getData=Object(o.a)(n.a.mark((function t(){var r,a,s,o,c,d,i,u,p,l,m,h,f,b,O,g,y,j;return n.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:a=new Date(e.props.order.createdAt),s=new Date(Date.now()),o=[78.267961,17.4126274],c=new k.a.Map({container:e.mapContainer,style:"mapbox://styles/sreekarnv/ckg0ssj7j2ia919oflok173f1",center:o,zoom:11,scrollZoom:!1}),e.map=c,d=e.res,"cancelled"===e.props.order.status?r=0:"delivered"===e.props.order.status?r=d.data.routes[0].geometry.coordinates.length-1:(i=a.getDate(),u=a.getMonth(),p=a.getFullYear(),l=s.getDate(),m=s.getMonth(),h=s.getFullYear(),i===l&&u===m&&p===h?(f=parseInt(s.getHours().toString(),10),b=parseInt(s.getMinutes().toString(),10),O=parseInt(a.getHours().toString(),10),g=parseInt(a.getMinutes().toString(),10),f===O?r=b-g:f>O&&(r=60*f+b-(60*O+g))):e.props.onChangeStatusHandler(),r>d.data.routes[0].geometry.coordinates.length&&(r=d.data.routes[0].geometry.coordinates.length-1,e.props.onChangeStatusHandler())),(new k.a.Marker).setLngLat(e.props.user.location.coordinates).addTo(c),(new k.a.Marker).setLngLat([78.267961,17.4126274]).addTo(c),new k.a.Popup({offset:30}).setLngLat([78.267961,17.4126274]).setHTML("<p>Burger House</p>").addTo(c),new k.a.Popup({offset:30}).setLngLat(e.props.user.location.coordinates).setHTML("<p>Your Location</p>").addTo(c),y={type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"LineString",coordinates:[e.props.user.location.coordinates,d.data.routes[0].geometry.coordinates[0]]}}]},e.route=y,j={type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"Point",coordinates:e.props.user.location.coordinates}}]},e.point=j,c.on("load",(function(){c.addSource("route",{type:"geojson",data:{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:Object(v.a)(d.data.routes[0].geometry.coordinates)}}}),c.addLayer({id:"route",type:"line",source:"route",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#0099CC","line-width":8}}),c.addSource("route1",{type:"geojson",data:y}),c.addSource("point",{type:"geojson",data:j}),c.addLayer({id:"route1",source:"route",type:"line",paint:{"line-width":2,"line-color":"transparent"}}),c.addLayer({id:"point",source:"point",type:"symbol",layout:{"icon-image":"car-15","icon-size":2,"icon-rotate":["get","bearing"],"icon-rotation-alignment":"map","icon-allow-overlap":!0,"icon-ignore-placement":!0}}),j.features[0].geometry.coordinates=Object(v.a)(d.data.routes[0].geometry.coordinates).reverse()[r],c.getSource("point").setData(j)}));case 16:case"end":return t.stop()}}),t)}))),e}return Object(d.a)(r,[{key:"componentDidMount",value:function(){var e=Object(o.a)(n.a.mark((function e(){var t,r;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="pk.eyJ1Ijoic3JlZWthcm52IiwiYSI6ImNrY2Vsem4xZzA3MmYycG53NDR6eWJidWUifQ.tnWqUEjgrrsKkfuhDzOBJQ",k.a.accessToken=t,e.next=4,j()({method:"GET",url:"https://api.mapbox.com/directions/v5/mapbox/driving/".concat(this.props.user.location.coordinates[0],",").concat(this.props.user.location.coordinates[1],";78.267961,17.4126274?geometries=geojson&access_token=").concat(t)});case 4:r=e.sent,this.res=r,this.getData();case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){this.map.remove()}},{key:"render",value:function(){var e=this;return l.a.createElement("div",null,l.a.createElement("button",{className:"btn btn__tertiary u-mb-2",onClick:this.getData},"Click Here To Update Map"),l.a.createElement("div",{className:"mapContainer",style:{width:"100%",height:"55vh"},ref:function(t){return e.mapContainer=t}}))}}]),r}(l.a.Component),E=function(e){Object(i.a)(r,e);var t=Object(u.a)(r);function r(){var e;Object(c.a)(this,r);for(var a=arguments.length,d=new Array(a),i=0;i<a;i++)d[i]=arguments[i];return(e=t.call.apply(t,[this].concat(d))).state={orders:null},e.onChangeStatusHandler=Object(o.a)(n.a.mark((function t(){var r;return n.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r="pending","pending"===e.state.orders.status&&(r="delivered"),t.next=4,e.props.updateOrderStatusAdmin({status:r,_id:e.props.match.params.id});case 4:"success"===e.props.orderStatus&&e.setState({orders:Object(s.a)(Object(s.a)({},e.state.orders),{},{status:e.props.updatedOrder.status})});case 5:case"end":return t.stop()}}),t)}))),e.onCancelOrder=Object(o.a)(n.a.mark((function t(){return n.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.props.updateOrderStatusAdmin({status:"cancelled",_id:e.props.match.params.id});case 2:"success"===e.props.orderStatus&&e.setState({orders:Object(s.a)(Object(s.a)({},e.state.orders),{},{status:e.props.updatedOrder.status})});case 3:case"end":return t.stop()}}),t)}))),e}return Object(d.a)(r,[{key:"componentDidMount",value:function(){var e=Object(o.a)(n.a.mark((function e(){var t;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.props.getOrder(this.props.match.params.id);case 2:if(this.props.order||!this.props.match.url.startsWith("/dashboard/manage-orders")){e.next=6;break}return e.abrupt("return",this.props.history.push("/dashboard/manage-orders"));case 6:if(this.props.order||!this.props.match.url.startsWith("/dashboard/my-orders")){e.next=10;break}return e.abrupt("return",this.props.history.push("/dashboard/my-orders"));case 10:t=this.props.order,this.setState({orders:t});case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=0;return this.state.orders&&this.state.orders.orders.map((function(e){return t+=e.items})),this.state.isLoading||!this.state.orders?l.a.createElement("div",{className:"dashboard__dashboard u-flex-center u-bg-white u-vh-100"},l.a.createElement(O.a,null)):l.a.createElement(g.a,null,l.a.createElement("div",{className:"order__details dashboard__dashboard"},l.a.createElement("button",{onClick:function(){return e.props.history.push(e.props.match.url.startsWith("/dashboard/my-orders")?"/dashboard/my-orders":"/dashboard/manage-orders")},className:"btn  btn__tertiary-back order__details-back-btn"},l.a.createElement("span",null,"\u2190"),"Back"),l.a.createElement("h4",{className:"heading-1 order__details-heading"},"Order Details"),l.a.createElement("div",{className:"order__details-info"},l.a.createElement("div",null,l.a.createElement("h2",null,"Order Id: #",this.props.match.params.id),l.a.createElement("h4",null,this.state.orders.user.name),l.a.createElement("p",null,this.state.orders.user.email)),l.a.createElement("div",{className:"order__details-info-status order__details-info-status--total-orders"},l.a.createElement(f.a,{className:"order__details-info-status-card",heading:"Order Status",value:this.state.orders.status}),"admin"===this.props.loggedInUser.role&&this.props.match.url.startsWith("/dashboard/manage-orders/")&&l.a.createElement("button",{onClick:this.onChangeStatusHandler,disabled:"cancelled"===this.state.orders.status,className:"btn btn__success--outline".concat("cancelled"===this.state.orders.status?"-disabled":""," ")},"Mark Order as ","pending"===this.state.orders.status?"Delivered":"Pending"),"/dashboard/my-orders/:id"===this.props.match.path&&l.a.createElement("button",{onClick:this.onCancelOrder,className:"btn btn__success--outline".concat("delivered"===this.state.orders.status||"cancelled"===this.state.orders.status?"-disabled":""," ")},"Cancel Order")),l.a.createElement(f.a,{className:"order__details-info-status-card",heading:"Total Orders",value:t})),l.a.createElement("div",{className:"order__details-list"},this.state.orders.orders.map((function(e,t){return l.a.createElement(h.a,{key:e._id+t,className:"order__details-list-item u-bg-".concat(e._id.foodType,"--opacity-35")},l.a.createElement(l.a.Fragment,null,l.a.createElement("p",{className:"order__details-list-item-name"},e._id.title," (",e.items,")"),l.a.createElement("div",{className:"order__details-list-item-ings"},e._id.ingredients.map((function(e){return l.a.createElement("p",{key:e._id},e._id.name?e._id.name:e.name," (",e.amount,")")})))))}))),l.a.createElement("div",{className:"order__details-map",style:{height:"100%",width:"100%"}},l.a.createElement("h4",{className:"heading-1 order__details-heading"},"Check Your Order Here"),l.a.createElement(w,{user:this.props.user,order:this.props.order,onChangeStatusHandler:this.onChangeStatusHandler}))))}}]),r}(p.Component);t.default=Object(m.b)((function(e){return{orders:e.orders.orders,getOrderInit:e.orders.getOrderInit,order:e.orders.order,loggedInUser:e.auth.user,orderStatus:e.orders.updateOrderStatusAdminStatus.status,updatedOrder:e.orders.updateOrderStatusAdminStatus.order,user:e.auth.user}}),(function(e){return{getOrder:function(t){return e(b.e(t))},updateOrderStatusAdmin:function(t){return e(b.f(t))}}}))(E)},80:function(e,t,r){"use strict";var a=r(4),n=r.n(a),s=r(7),o=r(13),c=r(14),d=r(16),i=r(15),u=r(1),p=r.n(u),l=r(8),m=r(19),h=r(5),f=function(e){Object(d.a)(r,e);var t=Object(i.a)(r);function r(){return Object(o.a)(this,r),t.apply(this,arguments)}return Object(c.a)(r,[{key:"componentDidMount",value:function(){var e=Object(s.a)(n.a.mark((function e(){return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.props.checkAuthState();case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){return this.props.user?this.props.children:p.a.createElement(h.a,{to:"/login"})}}]),r}(u.Component);t.a=Object(l.b)((function(e){return{user:e.auth.user,checkAuthInit:e.auth.checkAuthInit}}),(function(e){return{checkAuthState:function(){return e(m.a())}}}))(f)},82:function(e,t,r){"use strict";r.d(t,"d",(function(){return l})),r.d(t,"b",(function(){return h})),r.d(t,"a",(function(){return f})),r.d(t,"c",(function(){return g})),r.d(t,"f",(function(){return y})),r.d(t,"e",(function(){return _}));var a=r(4),n=r.n(a),s=r(78),o=r(0),c=r(7),d=r(2),i=r(18),u=r.n(i),p=function(e){return{type:d.O,error:e}},l=function(){return function(){var e=Object(c.a)(n.a.mark((function e(t){var r,a,c;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t({type:d.P}),e.prev=1,e.next=4,u.a.get("/api/v1/orders/me");case 4:r=e.sent,a=Object.keys(r.data.orders).map((function(e){return Object(o.a)(Object(o.a)({},r.data.orders[e]),{},{orders:[].concat(Object(s.a)(r.data.orders[e].customOrders),Object(s.a)(r.data.orders[e].menuOrders)),customOrders:null,menuOrders:null})})),t((n=a,{type:d.Q,orders:n})),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(1),c=Object(o.a)({},e.t0).response,t(p(c));case 13:case"end":return e.stop()}var n}),e,null,[[1,9]])})));return function(t){return e.apply(this,arguments)}}()},m=function(e){return{type:d.o,error:e}},h=function(e){return function(){var t=Object(c.a)(n.a.mark((function t(r){var a,s;return n.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r({type:d.p}),t.prev=1,t.next=4,u()({method:"POST",url:"/api/v1/orders",data:e});case 4:a=t.sent,r((n=a.data.orders,{type:d.q,orders:n})),t.next=12;break;case 8:t.prev=8,t.t0=t.catch(1),s=Object(o.a)({},t.t0).response,r(m(s));case 12:case"end":return t.stop()}var n}),t,null,[[1,8]])})));return function(e){return t.apply(this,arguments)}}()},f=function(){return{type:d.f}},b=function(e){var t=e.order,r=e.totalOrders,a=e.pendingOrders,n=e.completedOrders,s=e.totalPrice;return{type:d.K,orders:t,totalOrders:r,pendingOrders:a,completedOrders:n,totalPrice:s}},O=function(e){return{type:d.I,error:e}},g=function(e){return function(){var t=Object(c.a)(n.a.mark((function t(r){var a,c,i,p,l,m,h,f,g;return n.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r({type:d.J}),t.prev=1,a=[],c="",t.next=6,u.a.get("/api/v1/orders");case 6:if(p=t.sent,"All Orders"===e){t.next=13;break}return c="?status=".concat(e),t.next=11,u.a.get("/api/v1/orders".concat(c));case 11:i=t.sent,Object.keys(i.data.orders).map((function(e){return a.push(Object(o.a)(Object(o.a)({},i.data.orders[e]),{},{orders:[].concat(Object(s.a)(p.data.orders[e].customOrders),Object(s.a)(p.data.orders[e].menuOrders)),customOrders:null,menuOrders:null})),a}));case 13:l=p.data.orders.length,m=0,h=0,f=0,Object.keys(p.data.orders).map((function(t){return"pending"===p.data.orders[t].status?h+=1:"delivered"===p.data.orders[t].status&&(f+=1),"cancelled"!==p.data.orders[t].status&&(m+=p.data.orders[t].price),"All Orders"===e?(a.push(Object(o.a)(Object(o.a)({},p.data.orders[t]),{},{orders:[].concat(Object(s.a)(p.data.orders[t].customOrders),Object(s.a)(p.data.orders[t].menuOrders)),customOrders:null,menuOrders:null})),a):""})),r(b({order:a,totalOrders:l,pendingOrders:h,completedOrders:f,totalPrice:m})),t.next=25;break;case 21:t.prev=21,t.t0=t.catch(1),g=Object(o.a)({},t.t0).response,r(O(g));case 25:case"end":return t.stop()}}),t,null,[[1,21]])})));return function(e){return t.apply(this,arguments)}}()},v=function(e){return{type:d.Hb,response:e}},y=function(e){var t=e.status,r=e._id;return function(){var e=Object(c.a)(n.a.mark((function e(a){var s;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,u()({url:"/api/v1/orders/".concat(r),method:"PATCH",data:{status:t}});case 3:s=e.sent,a(v(s.data)),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),a(v(e.t0.response.data));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}()},j=function(e){return{type:d.Z,order:e}},_=function(e){return function(){var t=Object(c.a)(n.a.mark((function t(r){var a,c,i;return n.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r({type:d.Y}),t.prev=1,t.next=4,u()({url:"/api/v1/orders/".concat(e),method:"get"});case 4:a=t.sent,i=[],a.data.order.customOrders.map((function(e){return i.push({_id:{ingredients:e.ingredients,title:e.name,foodType:e.foodType,_id:e._id,photo:e.photo,price:e.price},items:parseInt(e.items)}),i})),c=Object(o.a)(Object(o.a)({},a.data.order),{},{orders:[].concat(i,Object(s.a)(a.data.order.menuOrders)),customOrders:null,menuOrders:null}),r(j(c)),t.next=14;break;case 11:t.prev=11,t.t0=t.catch(1),r((n=t.t0.response.data,{type:d.Z,error:n}));case 14:case"end":return t.stop()}var n}),t,null,[[1,11]])})));return function(e){return t.apply(this,arguments)}}()}},87:function(e,t,r){"use strict";var a=r(1),n=r.n(a),s=r(24);t.a=function(e){return n.a.createElement(s.b,{to:e.to?e.to:"#",className:"list__item ".concat(e.className),style:{listStyle:"none"}},e.children)}},90:function(e,t,r){"use strict";var a=r(1),n=r.n(a);t.a=function(e){return n.a.createElement("div",{className:"card__status ".concat(e.className)},n.a.createElement("h2",null,e.heading),n.a.createElement("p",null,e.value))}}}]);
//# sourceMappingURL=14.0b32617d.chunk.js.map